<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ã—ã™â˜…ã‚ã</title>
    <style>
        /* CSSã‚¹ã‚¿ã‚¤ãƒ«ã¯ã“ã“ã«ã‚ã‚Šã¾ã™ */
        body { font-family: sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        h1 { border-bottom: 2px solid #ccc; padding-bottom: 5px; }
        .report-form input[type="text"], .report-form textarea, .report-form select {
            width: 100%; padding: 8px; margin-bottom: 10px; box-sizing: border-box;
        }
        .report-form button { padding: 10px 15px; background-color: #4CAF50; color: white; border: none; cursor: pointer; }
        .report-item { border: 1px solid #eee; padding: 15px; margin-bottom: 10px; border-radius: 5px; }
        /* report-headerã‚’å°‘ã—èª¿æ•´ã—ã¦ã€ã„ã„ã­ãƒªã‚¹ãƒˆã®è¡¨ç¤ºã‚¹ãƒšãƒ¼ã‚¹ã‚’ç¢ºä¿ */
        .report-header { display: flex; justify-content: space-between; font-size: 0.9em; color: #666; margin-bottom: 5px;}
        .report-content strong { display: block; margin-top: 5px; color: #333; }
        .like-button { background-color: #f0f0f0; border: none; padding: 5px 10px; cursor: pointer; border-radius: 3px; }
        /* æ–°ã—ã„ã‚¹ã‚¿ã‚¤ãƒ«ï¼šã„ã„ã­ã—ãŸäººã®åå‰ãƒªã‚¹ãƒˆç”¨ */
        .liked-by-list { 
            font-size: 0.9em; 
            color: #444; 
            margin-top: 5px;
            /* ã„ã„ã­ãƒœã‚¿ãƒ³ã¨åŒã˜è¡Œã«è¡¨ç¤ºã™ã‚‹ãŸã‚ã«ã€flexã‚¢ã‚¤ãƒ†ãƒ ã«ã™ã‚‹ã‹ã€report-headerå†…ã«ç½®ãå¿…è¦ãŒã‚ã‚Šã¾ã™ãŒã€
               ä»Šå›ã¯ã‚·ãƒ³ãƒ—ãƒ«ã«ãƒœã‚¿ãƒ³ã®ä¸‹ã«è¡¨ç¤ºã—ã¾ã™ã€‚ */
            text-align: right; 
        }
    </style>
</head>
<body>

    <h1>ã‚·ã‚¹ãƒ†ãƒ èª²ã€€æ—¥å ±</h1>

    <form class="report-form">
        <h2>æ—¥å ±ã‚’æŠ•ç¨¿ã™ã‚‹</h2>
        <input type="text" id="name" placeholder="åå‰ (å¿…é ˆ)" required>
    
    <label>ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ (å¿…é ˆ):</label><br>

<div class="condition-radios">
    <input type="radio" id="cond1" name="condition" value="ğŸ¤©" required>
    <label for="cond1">ğŸ¤© (æœ€é«˜)</label>
    
    <input type="radio" id="cond2" name="condition" value="ğŸ˜€" required>
    <label for="cond2">ğŸ˜€ (å¥½èª¿)</label>
    
    <input type="radio" id="cond3" name="condition" value="ğŸ™‚" required>
    <label for="cond3">ğŸ™‚ (æ™®é€š)</label>
    
    <input type="radio" id="cond4" name="condition" value="ğŸ˜" required>
    <label for="cond4">ğŸ˜ (ã¼ã¡ã¼ã¡)</label>
    
    <input type="radio" id="cond5" name="condition" value="ğŸ˜µâ€ğŸ’«" required>
    <label for="cond5">ğŸ˜µâ€ğŸ’« (ã‚„ã‚„ç–²åŠ´)</label>
    
    <input type="radio" id="cond6" name="condition" value="ğŸ˜«" required>
    <label for="cond6">ğŸ˜« (ä¸èª¿)</label>
    
    <input type="radio" id="cond7" name="condition" value="ğŸ˜´" required>
    <label for="cond7">ğŸ˜´ (å¯ä¸è¶³)</label>
    
    <input type="radio" id="cond8" name="condition" value="ğŸ’ª" required>
    <label for="cond8">ğŸ’ª (ã‚„ã‚‹æ°—æº€ã€…)</label>
    
    <input type="radio" id="cond9" name="condition" value="ğŸ¤”" required>
    <label for="cond9">ğŸ¤” (è€ƒãˆä¸­)</label>
    
    <input type="radio" id="cond10" name="condition" value="ğŸ¤¢" required>
    <label for="cond10">ğŸ¤¢ (äºŒæ—¥é…”ã„)</label>

</div>
<br>
    
    <textarea id="todayTask" placeholder="ä»Šæ—¥ã‚„ã£ãŸã“ã¨ (å¿…é ˆ)" rows="3" required></textarea>
    <textarea id="nextTask" placeholder="ç¿Œå–¶æ¥­æ—¥ã‚„ã‚‹ã“ã¨ (å¿…é ˆ)" rows="3" required></textarea>
    <textarea id="impression" placeholder="æ‰€æ„Ÿãƒ»å­¦ã³ (ä»»æ„)" rows="3"></textarea>
    
    <button type="button" onclick="postReport()">é€ä¿¡</button> </form>

    <hr>
    
    <h2>éå»ã®æ—¥å ±ä¸€è¦§</h2>
    <div id="reportList">
        </div>

    <script>
        // ----------------------------------------------------
        // 1. è¨­å®š
        // ----------------------------------------------------
        // ã“ã“ã«GASã®ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªURLã‚’è²¼ã‚Šä»˜ã‘ã¾ã™
        const GAS_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxamhnhISo4BymAy8-0_c1LbJTJtPiWA4wXHdjWJbwgugO-yFpwsAH6v322AZZooIfDKQ/exec'; 
// ----------------------------------------------------
// æ–°ã—ã„è£œåŠ©é–¢æ•°: æ—¥ä»˜ã‚’ 'YYYY/MM/DD HHæ™‚MMåˆ†' å½¢å¼ã«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã™ã‚‹
// ----------------------------------------------------
function formatDate(dateString) {
    const date = new Date(dateString);
    
    // æ—¥ä»˜ã®å„è¦ç´ ã‚’å–å¾—
    const year = date.getFullYear();
    // getMonth() ã¯ 0 ã‹ã‚‰å§‹ã¾ã‚‹ãŸã‚ +1
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    const hour = String(date.getHours()).padStart(2, '0');
    const minute = String(date.getMinutes()).padStart(2, '0');
    
    // ã”è¦æœ›ã®å½¢å¼ '2025/11/11 00æ™‚00åˆ†' ã«æ•´å½¢ã—ã¦è¿”ã™
    return `${year}/${month}/${day} ${hour}æ™‚${minute}åˆ†`;
}
        // ----------------------------------------------------
        // 2. æ©Ÿèƒ½ â‘¡: æ—¥å ±ä¸€è¦§è¡¨ç¤ºæ©Ÿèƒ½ (GET)
        // ----------------------------------------------------
        async function fetchReports() {
           // ----------------------------------------------------
// 2. æ©Ÿèƒ½ â‘¡: æ—¥å ±ä¸€è¦§è¡¨ç¤ºæ©Ÿèƒ½ (GET)
// ----------------------------------------------------
async function fetchReports() {
    // ğŸ’¡ Point 1: reportsã‚’letã§å®£è¨€ã—ã€åˆæœŸå€¤ã¨ã—ã¦ç©ºã®é…åˆ—ï¼ˆã¾ãŸã¯ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼‰ã‚’è¨­å®š
    let reports = []; 
    
    // ä»®ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ ï¼ˆãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼‰
    const dummyData = [
        { id: '1', name: 'ä½è—¤', date: '2025-12-07T08:58:00.000Z', condition: 'ğŸ˜€', todayTask: 'ã‚', nextTask: 'ã‚', impression: 'ã‚', likedBy: ['çŸ³äº•', 'æ¸¡è¾º'] },
        { id: '2', name: 'ç”°ä¸­', date: '2025-12-06T10:30:00.000Z', condition: 'ğŸ’ª', todayTask: 'ãƒ†ã‚¹ãƒˆ', nextTask: 'ãƒ†ã‚¹ãƒˆ', impression: 'ãƒ†ã‚¹ãƒˆ', likedBy: ['æ± ä¸Š'] },
        { id: '3', name: 'å±±æœ¬', date: '2025-12-05T09:15:00.000Z', condition: 'ğŸ™‚', todayTask: 'ä½œæ¥­', nextTask: 'ä½œæ¥­', impression: 'ä½œæ¥­', likedBy: [] } // ã„ã„ã­ãªã—
    ];
    
    // ğŸ’¡ Point 2: ã¾ãš reports ã«ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®šã—ã¾ã™ (é€šä¿¡ãŒå¤±æ•—ã—ãŸã¨ãã®ä¿é™º)
    reports = dummyData;

    try {
        // --- ã‚µãƒ¼ãƒãƒ¼é€šä¿¡ã‚’é–‹å§‹ï¼ˆGASã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ï¼‰ ---
        const response = await fetch(GAS_WEB_APP_URL); 
        const data = await response.json(); // responseã®ä¸­èº«ã‚’JSONã¨ã—ã¦è§£æ

        // ğŸ’¡ Point 3: ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ãŒæ­£å¸¸ã«è¿”ã£ã¦ããŸå ´åˆã®ã¿ã€reports ã‚’ä¸Šæ›¸ãã—ã¾ã™
        if (data && data.data && data.data.length > 0) {
             reports = data.data; 
             console.log("GASã‹ã‚‰æ­£å¸¸ã«ãƒ‡ãƒ¼ã‚¿ã‚’å—ä¿¡ã—ã¾ã—ãŸã€‚");
        } else {
             // å¿œç­”ã¯ã‚ã£ãŸãŒãƒ‡ãƒ¼ã‚¿ãŒç©ºã ã£ãŸå ´åˆ
             console.warn("GASã‹ã‚‰ã®å¿œç­”ã¯ã‚ã‚Šã¾ã—ãŸãŒã€æ—¥å ±ãƒ‡ãƒ¼ã‚¿ãŒç©ºã§ã™ã€‚ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚");
        }
    
    } catch (error) {
        // é€šä¿¡ã‚¨ãƒ©ãƒ¼ã‚„JSONè§£æã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã€ã“ã®ãƒ–ãƒ­ãƒƒã‚¯ã«æ¥ã‚‹
        // Point 2ã§è¨­å®šã—ãŸãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ãŒãã®ã¾ã¾ä½¿ã‚ã‚Œã¾ã™ã€‚
        console.error("æ—¥å ±ã®èª­ã¿è¾¼ã¿ä¸­ã«é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚:", error);
        document.getElementById('reportList').innerHTML = '<p>é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ã¦è¡¨ç¤ºã—ã¾ã™ã€‚</p>';
    }
    
    // --- ç”»é¢è¡¨ç¤ºå‡¦ç† ---
    
    // try/catchã®å¤–ã«å‡ºã™ã“ã¨ã§ã€reportsãŒGASãƒ‡ãƒ¼ã‚¿ã§ã‚‚ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã§ã‚‚è¡¨ç¤ºã•ã‚Œã‚‹
    const reportListElement = document.getElementById('reportList');
    
    // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã€ã“ã“ã§ã‚¯ãƒªã‚¢ã—ãªã„ã‚ˆã†ã«æ³¨æ„
    if (document.getElementById('reportList').innerHTML.indexOf("é€šä¿¡ã‚¨ãƒ©ãƒ¼") === -1) {
        reportListElement.innerHTML = ''; 
    }

    // reportsã¯å¿…ãšå®šç¾©ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€ã“ã“ã§å®‰å…¨ã«ãƒ«ãƒ¼ãƒ—ã§ãã¾ã™
    reports.forEach(report => {
        const formattedDate = formatDate(report.date);Â 
        
        const likedByListHtml = report.likedBy && report.likedBy.length > 0
            ? `<div class="liked-by-list">${report.likedBy.map(name => `**${name}ã„ã„ã­**`).join(' ')}</div>`
            : ''; 

        const item = document.createElement('div');
        item.className = 'report-item';
        item.innerHTML = `
            <div class="report-header">
                <span>**${report.name}** / ${formattedDate} / ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³: ${report.condition}</span>
                <span class="like-section">
                    <button class="like-button" onclick="likeReport('${report.id}', this)">
                        ã„ã„ã­ğŸ‘ (${report.likedBy ? report.likedBy.length : 0})
                    </button>
                    ${likedByListHtml}
                </span>
            </div>
            <div class="report-content">
                <strong>ä»Šæ—¥ã‚„ã£ãŸã“ã¨:</strong> ${report.todayTask.replace(/\n/g, '<br>')}
                <strong>ç¿Œå–¶æ¥­æ—¥ã‚„ã‚‹ã“ã¨:</strong> ${report.nextTask.replace(/\n/g, '<br>')}
                <strong>æ‰€æ„Ÿãƒ»å­¦ã³:</strong> ${report.impression.replace(/\n/g, '<br>')}
            </div>
        `;
        reportListElement.appendChild(item);
    });
}

            } catch (error) {
                console.error("æ—¥å ±ã®èª­ã¿è¾¼ã¿ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:", error);
                // å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿å–å¾—æ™‚ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                // document.getElementById('reportList').innerHTML = '<p>æ—¥å ±ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</p>';
                document.getElementById('reportList').innerHTML = '<p>ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ã¦è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚</p>';
            }
        }
        
        // ----------------------------------------------------
        // 3. æ©Ÿèƒ½ â‘ : æ—¥å ±æŠ•ç¨¿æ©Ÿèƒ½ (POST) 
        // ----------------------------------------------------
        async function postReport() {
            const name = document.getElementById('name').value.trim();
            const conditionElement = document.querySelector('input[name="condition"]:checked');
            const condition = conditionElement ? conditionElement.value : '';
            const todayTask = document.getElementById('todayTask').value.trim();
            const nextTask = document.getElementById('nextTask').value.trim();
            const impression = document.getElementById('impression').value.trim();

            if (!name || !condition || !todayTask || !nextTask) {
                alert('åå‰ã€ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ã€ä»Šæ—¥ã‚„ã£ãŸã“ã¨ã€ç¿Œå–¶æ¥­æ—¥ã‚„ã‚‹ã“ã¨ ã¯å¿…é ˆé …ç›®ã§ã™ã€‚');
                return;
            }

            const postData = {
                name: name, condition: condition, todayTask: todayTask, nextTask: nextTask, impression: impression
            };

            try {
                // CORSã‚¨ãƒ©ãƒ¼å›é¿ã®ãŸã‚ no-cors ã‚’ä½¿ç”¨
                await fetch(GAS_WEB_APP_URL, {
                    method: 'POST',
                    mode: 'no-cors', 
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(postData) 
                });

                alert('æ—¥å ±ãŒæ­£å¸¸ã«æŠ•ç¨¿ã•ã‚Œã¾ã—ãŸï¼');
                document.querySelector('.report-form').reset(); 
                fetchReports(); // æŠ•ç¨¿å¾Œã€ä¸€è¦§ã‚’æ›´æ–°

            } catch (error) {
                console.error('æŠ•ç¨¿ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
                alert('é€šä¿¡ã‚¨ãƒ©ãƒ¼ã«ã‚ˆã‚ŠæŠ•ç¨¿ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚');
            }
        }

        // ----------------------------------------------------
        // 4. æ©Ÿèƒ½ â‘¢: ã€Œã„ã„ã­ã€ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ 
        // ----------------------------------------------------
        async function likeReport(reportId, buttonElement) {
            // ä»Šå›ã¯ã¾ã ã‚µãƒ¼ãƒãƒ¼å´ï¼ˆGASï¼‰ã®å‡¦ç†ãŒãªã„ãŸã‚ã€ã‚¢ãƒ©ãƒ¼ãƒˆã®ã¿ã«ã—ã¦ã„ã¾ã™ã€‚
            // èª°ãŒã„ã„ã­ã—ãŸã‹ã®æƒ…å ±ã‚’GASã¸é€ã‚‹å‡¦ç†ã‚’å¾Œã§è¿½åŠ ã—ã¾ã—ã‚‡ã†ã€‚
            alert(`ID: ${reportId} ã®æ—¥å ±ã«ã€Œã„ã„ã­ã€ã‚’æŠ¼ã—ã¾ã—ãŸï¼\n\nï¼ˆâ€»ç¾åœ¨ã¯ã€ã„ã„ã­ã—ãŸäººã®åå‰ã‚’ã‚µãƒ¼ãƒãƒ¼ã«é€ã‚‹å‡¦ç†ã¯ä¿ç•™ä¸­ã§ã™ï¼‰`);
        }
        
        // 5. ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®å‡¦ç†
        window.onload = fetchReports;

    </script>
</body>
</html>
