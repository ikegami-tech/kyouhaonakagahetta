<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GASé€£æºã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒª</title>
    <style>
        body { font-family: sans-serif; margin: 20px; }
        #dataList { margin-top: 20px; border-top: 1px solid #ccc; padding-top: 10px; }
        .record { padding: 5px 0; border-bottom: 1px dotted #eee; }
        .record:last-child { border-bottom: none; }
        input[type="text"] { padding: 8px; width: 200px; }
        button { padding: 10px 15px; cursor: pointer; }
    </style>
</head>
<body>

    <h1>ğŸ“ ãƒ‡ãƒ¼ã‚¿å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ </h1>
    <p>ãŠåå‰ã‚’å…¥åŠ›ã—ã¦é€ä¿¡ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</p>
    <form id="dataForm">
        <label for="name">ãŠåå‰:</label>
        <input type="text" id="name" required>
        <button type="submit">é€ä¿¡</button>
        <p id="message"></p>
    </form>

    <hr>

    <h2>ğŸ“œ ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ä¸€è¦§</h2>
    <div id="dataList">
        <p>ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
    </div>

    <script>
        // â˜…â˜…â˜… ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸGASã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã®URLã«ç½®ãæ›ãˆã¦ãã ã•ã„ â˜…â˜…â˜…
        const GAS_WEB_APP_URL = "ã€ã“ã“ã«GASã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã®URLã‚’è²¼ã‚Šä»˜ã‘ã€‘";
        // â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…

        const dataForm = document.getElementById('dataForm');
        const dataList = document.getElementById('dataList');
        const messageElement = document.getElementById('message');

        // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡æ™‚ã®å‡¦ç† (ãƒ‡ãƒ¼ã‚¿ä¿å­˜)
        dataForm.addEventListener('submit', function(e) {
            e.preventDefault(); // ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé€ä¿¡ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
            const nameInput = document.getElementById('name');
            const name = nameInput.value;

            if (!name) {
                alert("åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
                return;
            }

            messageElement.textContent = "é€ä¿¡ä¸­...";
            messageElement.style.color = 'blue';

            // GASã¸ãƒ‡ãƒ¼ã‚¿ã‚’POSTé€ä¿¡
            fetch(GAS_WEB_APP_URL, {
                method: 'POST',
                // JSONå½¢å¼ã§ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡
                body: JSON.stringify({ name: name }),
                headers: {
                    'Content-Type': 'application/json',
                },
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    messageElement.textContent = "âœ… ãƒ‡ãƒ¼ã‚¿ãŒæ­£å¸¸ã«ä¿å­˜ã•ã‚Œã¾ã—ãŸï¼";
                    messageElement.style.color = 'green';
                    nameInput.value = ''; // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¯ãƒªã‚¢
                    fetchDataAndDisplay(); // ãƒ‡ãƒ¼ã‚¿ä¸€è¦§ã‚’å†èª­ã¿è¾¼ã¿
                } else {
                    messageElement.textContent = `âŒ ä¿å­˜ã‚¨ãƒ©ãƒ¼: ${data.message}`;
                    messageElement.style.color = 'red';
                }
            })
            .catch(error => {
                messageElement.textContent = `âŒ é€šä¿¡ã‚¨ãƒ©ãƒ¼: ${error.message}`;
                messageElement.style.color = 'red';
                console.error('Error:', error);
            });
        });

        // ãƒ‡ãƒ¼ã‚¿ä¸€è¦§ã‚’å–å¾—ã—ã¦è¡¨ç¤ºã™ã‚‹å‡¦ç†
        function fetchDataAndDisplay() {
            dataList.innerHTML = '<p>ãƒ‡ãƒ¼ã‚¿å–å¾—ä¸­...</p>'; // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º

            // GASã¸ãƒ‡ãƒ¼ã‚¿ã‚’GETé€ä¿¡ (ãƒ‡ãƒ¼ã‚¿å–å¾—)
            fetch(GAS_WEB_APP_URL)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                dataList.innerHTML = ''; // ä¸€è¦§ã‚’ã‚¯ãƒªã‚¢

                if (data.status === 'success' && data.data && data.data.length > 0) {
                    // ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚¹ãƒˆã¨ã—ã¦è¡¨ç¤º
                    data.data.forEach(record => {
                        const div = document.createElement('div');
                        div.className = 'record';
                        div.textContent = `åå‰: ${record.name} (ä¿å­˜æ—¥æ™‚: ${record.timestamp})`;
                        dataList.appendChild(div);
                    });
                } else if (data.status === 'success' && data.data.length === 0) {
                    dataList.innerHTML = '<p>ã¾ã ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
                } else {
                    dataList.innerHTML = `<p>ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼: ${data.message}</p>`;
                }
            })
            .catch(error => {
                dataList.innerHTML = `<p style="color:red;">ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}</p>`;
                console.error('Fetch Error:', error);
            });
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†æ™‚ã«ãƒ‡ãƒ¼ã‚¿ä¸€è¦§ã‚’èª­ã¿è¾¼ã‚€
        window.onload = fetchDataAndDisplay;

    </script>
</body>
</html>
