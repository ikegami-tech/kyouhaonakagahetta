<!DOCTYPE html>
<html lang="ja">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <title>ã—ã™â˜…ã‚ã</title>
Â  Â  <style>
Â  Â  Â  Â  /* CSSã‚¹ã‚¿ã‚¤ãƒ«ã¯ã“ã“ã«ã‚ã‚Šã¾ã™ */
Â  Â  Â  Â  body { font-family: sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
Â  Â  Â  Â  h1 { border-bottom: 2px solid #ccc; padding-bottom: 5px; }
Â  Â  Â  Â  .report-form input[type="text"], .report-form textarea, .report-form select {
Â  Â  Â  Â  Â  Â  width: 100%; padding: 8px; margin-bottom: 10px; box-sizing: border-box;
Â  Â  Â  Â  }
Â  Â  Â  Â  .report-form button { padding: 10px 15px; background-color: #4CAF50; color: white; border: none; cursor: pointer; }
Â  Â  Â  Â  .report-item { border: 1px solid #eee; padding: 15px; margin-bottom: 10px; border-radius: 5px; }
Â  Â  Â  Â  /* report-headerã‚’å°‘ã—èª¿æ•´ã—ã¦ã€ã„ã„ã­ãƒªã‚¹ãƒˆã®è¡¨ç¤ºã‚¹ãƒšãƒ¼ã‚¹ã‚’ç¢ºä¿ */
Â  Â  Â  Â  .report-header { display: flex; justify-content: space-between; font-size: 0.9em; color: #666; margin-bottom: 5px;}
Â  Â  Â  Â  .report-content strong { display: block; margin-top: 5px; color: #333; }
Â  Â  Â  Â  .like-button { background-color: #f0f0f0; border: none; padding: 5px 10px; cursor: pointer; border-radius: 3px; }
Â  Â  Â  Â  /* æ–°ã—ã„ã‚¹ã‚¿ã‚¤ãƒ«ï¼šã„ã„ã­ã—ãŸäººã®åå‰ãƒªã‚¹ãƒˆç”¨ */
Â  Â  Â  Â  .liked-by-list {Â 
Â  Â  Â  Â  Â  Â  font-size: 0.9em;Â 
Â  Â  Â  Â  Â  Â  color: #444;Â 
Â  Â  Â  Â  Â  Â  margin-top: 5px;
Â  Â  Â  Â  Â  Â  text-align: right;Â 
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>

Â  Â  <h1>ã‚·ã‚¹ãƒ†ãƒ èª²ã€€æ—¥å ±</h1>

Â  Â  <form class="report-form">
Â  Â  Â  Â  <h2>æ—¥å ±ã‚’æŠ•ç¨¿ã™ã‚‹</h2>
Â  Â  Â  Â  <input type="text" id="name" placeholder="åå‰ (ã„ã„ã­ã‚’æŠ¼ã™äºº/æŠ•ç¨¿è€…) (å¿…é ˆ)" required>
Â  Â Â 
Â  Â  <label>ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ (å¿…é ˆ):</label><br>

<div class="condition-radios">
Â  Â  <input type="radio" id="cond1" name="condition" value="ğŸ¤©" required>
Â  Â  <label for="cond1">ğŸ¤© (æœ€é«˜)</label>
Â  Â Â 
Â  Â  <input type="radio" id="cond2" name="condition" value="ğŸ˜€" required>
Â  Â  <label for="cond2">ğŸ˜€ (å¥½èª¿)</label>
Â  Â Â 
Â  Â  <input type="radio" id="cond3" name="condition" value="ğŸ™‚" required>
Â  Â  <label for="cond3">ğŸ™‚ (æ™®é€š)</label>
Â  Â Â 
Â  Â  <input type="radio" id="cond4" name="condition" value="ğŸ˜" required>
Â  Â  <label for="cond4">ğŸ˜ (ã¼ã¡ã¼ã¡)</label>
Â  Â Â 
Â  Â  <input type="radio" id="cond5" name="condition" value="ğŸ˜µâ€ğŸ’«" required>
Â  Â  <label for="cond5">ğŸ˜µâ€ğŸ’« (ã‚„ã‚„ç–²åŠ´)</label>
Â  Â Â 
Â  Â  <input type="radio" id="cond6" name="condition" value="ğŸ˜«" required>
Â  Â  <label for="cond6">ğŸ˜« (ä¸èª¿)</label>
Â  Â Â 
Â  Â  <input type="radio" id="cond7" name="condition" value="ğŸ˜´" required>
Â  Â  <label for="cond7">ğŸ˜´ (å¯ä¸è¶³)</label>
Â  Â Â 
Â  Â  <input type="radio" id="cond8" name="condition" value="ğŸ’ª" required>
Â  Â  <label for="cond8">ğŸ’ª (ã‚„ã‚‹æ°—æº€ã€…)</label>
Â  Â Â 
Â  Â  <input type="radio" id="cond9" name="condition" value="ğŸ¤”" required>
Â  Â  <label for="cond9">ğŸ¤” (è€ƒãˆä¸­)</label>
Â  Â Â 
Â  Â  <input type="radio" id="cond10" name="condition" value="ğŸ¤¢" required>
Â  Â  <label for="cond10">ğŸ¤¢ (äºŒæ—¥é…”ã„)</label>

</div>
<br>
Â  Â Â 
Â  Â  <textarea id="todayTask" placeholder="ä»Šæ—¥ã‚„ã£ãŸã“ã¨ (å¿…é ˆ)" rows="3" required></textarea>
Â  Â  <textarea id="nextTask" placeholder="ç¿Œå–¶æ¥­æ—¥ã‚„ã‚‹ã“ã¨ (å¿…é ˆ)" rows="3" required></textarea>
Â  Â  <textarea id="impression" placeholder="æ‰€æ„Ÿãƒ»å­¦ã³ (ä»»æ„)" rows="3"></textarea>
Â  Â Â 
Â  Â  <button type="button" onclick="postReport()">é€ä¿¡</button> </form>

Â  Â  <hr>
Â  Â Â 
Â  Â  <h2>éå»ã®æ—¥å ±ä¸€è¦§</h2>
Â  Â  <div id="reportList">
Â  Â  Â  Â  </div>

Â  Â  <script>
Â  Â  Â  Â  // ----------------------------------------------------
Â  Â  Â  Â  // 1. è¨­å®š
Â  Â  Â  Â  // ----------------------------------------------------
Â  Â  Â  Â  // ã“ã“ã«GASã®ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªURLã‚’è²¼ã‚Šä»˜ã‘ã¾ã™
Â  Â  Â  Â  // â˜…ã”è‡ªèº«ã®GASã®URLãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ï¼
Â  Â  Â  Â  const GAS_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbwV0pz9MJwhiHAMywG6nMRBWefmcpa1YpSDYwfAYkrROpiFTez9TuINq0tfM0T3PvdGGg/exec';Â 

Â  Â  Â  Â  // ----------------------------------------------------
Â  Â  Â  Â  // 2. æ©Ÿèƒ½ â‘¡: æ—¥å ±ä¸€è¦§è¡¨ç¤ºæ©Ÿèƒ½ (GET)
Â  Â  Â  Â  // ----------------------------------------------------
Â  Â  Â  Â  async function fetchReports() {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  // å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿å–å¾—å‡¦ç†
Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(GAS_WEB_APP_URL);Â 
Â  Â  Â  Â  Â  Â  Â  Â  // é€šä¿¡å¤±æ•—æ™‚ã¯ã‚¨ãƒ©ãƒ¼ã‚’æŠ•ã’ã‚‹
Â  Â  Â  Â  Â  Â  Â  Â  if (!response.ok) throw new Error('GASã‹ã‚‰ã®å¿œç­”ãŒã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚');
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  const data = await response.json();
Â  Â  Â  Â  Â  Â  Â  Â  const reports = data.data || []; // data.data ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ç©ºã®é…åˆ—ã«ã™ã‚‹
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const reportListElement = document.getElementById('reportList');
Â  Â  Â  Â  Â  Â  Â  Â  reportListElement.innerHTML = '';Â 
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  reports.forEach(report => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ã„ã„ã­ã—ãŸäººã®ãƒªã‚¹ãƒˆè¡¨ç¤ºç”¨ã®æ–‡å­—åˆ—ã‚’ç”Ÿæˆ
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ã“ã“ã‚’ç”»åƒã®è¡¨ç¤ºå½¢å¼ã«åˆã‚ã›ã¾ã™
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const likedByListHtml = report.likedBy && report.likedBy.length > 0
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ? `<div class="liked-by-list">${report.likedBy.map(name => `**${name}ã„ã„ã­**`).join('')}</div>`
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  : ''; 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const item = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.className = 'report-item';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="report-header">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>**${report.name}** / ${report.date} / ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³: ${report.condition}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="like-section">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="like-button" onclick="likeReport('${report.id}', this)">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ã„ã„ã­ğŸ‘ (${report.likedBy ? report.likedBy.length : 0})
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${likedByListHtml}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="report-content">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <strong>ä»Šæ—¥ã‚„ã£ãŸã“ã¨:</strong> ${report.todayTask.replace(/\n/g, '<br>')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <strong>ç¿Œå–¶æ¥­æ—¥ã‚„ã‚‹ã“ã¨:</strong> ${report.nextTask.replace(/\n/g, '<br>')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <strong>æ‰€æ„Ÿãƒ»å­¦ã³:</strong> ${report.impression.replace(/\n/g, '<br>')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  reportListElement.appendChild(item);
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("æ—¥å ±ã®èª­ã¿è¾¼ã¿ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:", error);
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('reportList').innerHTML = `<p>æ—¥å ±ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}</p>`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // ----------------------------------------------------
Â  Â  Â  Â  // 3. æ©Ÿèƒ½ â‘ : æ—¥å ±æŠ•ç¨¿æ©Ÿèƒ½ (POST)Â 
Â  Â  Â  Â  // ----------------------------------------------------
Â  Â  Â  Â  async function postReport() {
Â  Â  Â  Â  Â  Â  const name = document.getElementById('name').value.trim();
Â  Â  Â  Â  Â  Â  const conditionElement = document.querySelector('input[name="condition"]:checked');
Â  Â  Â  Â  Â  Â  const condition = conditionElement ? conditionElement.value : '';
Â  Â  Â  Â  Â  Â  const todayTask = document.getElementById('todayTask').value.trim();
Â  Â  Â  Â  Â  Â  const nextTask = document.getElementById('nextTask').value.trim();
Â  Â  Â  Â  Â  Â  const impression = document.getElementById('impression').value.trim();

Â  Â  Â  Â  Â  Â  if (!name || !condition || !todayTask || !nextTask) {
Â  Â  Â  Â  Â  Â  Â  Â  alert('åå‰ã€ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ã€ä»Šæ—¥ã‚„ã£ãŸã“ã¨ã€ç¿Œå–¶æ¥­æ—¥ã‚„ã‚‹ã“ã¨ ã¯å¿…é ˆé …ç›®ã§ã™ã€‚');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const postData = {
Â  Â  Â  Â  Â  Â  Â  Â  action: 'post', 
Â  Â  Â  Â  Â  Â  Â  Â  name: name, condition: condition, todayTask: todayTask, nextTask: nextTask, impression: impression
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(GAS_WEB_APP_URL, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify(postData)Â 
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  const result = await response.json();

Â  Â  Â  Â  Â  Â  Â  Â  if(result.status === 'success'){
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert('æ—¥å ±ãŒæ­£å¸¸ã«æŠ•ç¨¿ã•ã‚Œã¾ã—ãŸï¼');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.querySelector('.report-form').reset();Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fetchReports(); // æŠ•ç¨¿å¾Œã€ä¸€è¦§ã‚’æ›´æ–°
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error(result.message || "æŠ•ç¨¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('æŠ•ç¨¿ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
Â  Â  Â  Â  Â  Â  Â  Â  alert('æŠ•ç¨¿å‡¦ç†ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚:' + error.message);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // ----------------------------------------------------
Â  Â  Â  Â  // 4. æ©Ÿèƒ½ â‘¢: ã€Œã„ã„ã­ã€ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ - ä¿®æ­£ç®‡æ‰€
Â  Â  Â  Â  // ----------------------------------------------------
Â  Â  Â  Â  async function likeReport(reportId, buttonElement) {
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // ãƒ•ã‚©ãƒ¼ãƒ ã®ã€Œåå‰ã€æ¬„ã«å…¥åŠ›ã•ã‚Œã¦ã„ã‚‹å€¤ã‚’ã€ã„ã„ã­ã‚’æŠ¼ã—ãŸäººï¼ˆlikerï¼‰ã¨è¦‹ãªã—ã¾ã™
Â  Â  Â  Â  Â  Â  const liker = document.getElementById('name').value.trim();
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  if (!liker) {
Â  Â  Â  Â  Â  Â  Â  Â  alert('ã„ã„ã­ã‚’ã™ã‚‹ã«ã¯ã€æ—¥å ±æŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ ã®ã€Œåå‰ã€æ¬„ã«ã‚ãªãŸã®åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const postData = {
Â  Â  Â  Â  Â  Â  Â  Â  action: 'like', Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  id: reportId,Â  Â  Â  // æ—¥å ±ã®UUIDã‚’é€ä¿¡
Â  Â  Â  Â  Â  Â  Â  Â  liker: likerÂ  Â  Â  Â 
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  // GASã¸ã„ã„ã­æƒ…å ±ã‚’é€ä¿¡
Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(GAS_WEB_APP_URL, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify(postData)
