<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ã—ã™â˜…ã‚ã</title>
    <style>
        /* CSSã‚¹ã‚¿ã‚¤ãƒ«ã¯ã“ã“ã«ã‚ã‚Šã¾ã™ */
        body { font-family: sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        h1 { border-bottom: 2px solid #ccc; padding-bottom: 5px; }
        .report-form input[type="text"], .report-form textarea, .report-form select {
            width: 100%; padding: 8px; margin-bottom: 10px; box-sizing: border-box;
        }
        .report-form button { padding: 10px 15px; background-color: #4CAF50; color: white; border: none; cursor: pointer; }
        .report-item { border: 1px solid #eee; padding: 15px; margin-bottom: 10px; border-radius: 5px; }
        .report-header { display: flex; justify-content: space-between; font-size: 0.9em; color: #666; margin-bottom: 5px;}
        .report-content strong { display: block; margin-top: 5px; color: #333; }
        .like-button { background-color: #f0f0f0; border: none; padding: 5px 10px; cursor: pointer; border-radius: 3px; }
        /* ã€è¿½åŠ ã€‘ä¸€è¦§ãƒ˜ãƒƒãƒ€ãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ«èª¿æ•´ */
        .report-list-header { 
            display: flex; 
            justify-content: space-between; /* å·¦å³ã«é…ç½® */
            align-items: center; 
            margin-bottom: 10px; 
        }
        .show-more-button { 
            background-color: #007bff; 
            color: white; 
            border: none; 
            padding: 8px 15px; 
            border-radius: 5px; 
            cursor: pointer; 
            font-size: 0.9em;
        }
    </style>
</head>
<body>

    <h1>SysLog (ã‚·ã‚¹ãƒ†ãƒ èª²æ—¥å ±)</h1>

    <form class="report-form">
        <h2>æ—¥å ±ã‚’æŠ•ç¨¿ã™ã‚‹</h2>
        <input type="text" id="name" placeholder="åå‰ (å¿…é ˆ)" required>
    
    <label>ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ (å¿…é ˆ):</label><br>

<div class="condition-radios">
    <input type="radio" id="cond1" name="condition" value="ğŸ¤©" required>
    <label for="cond1">ğŸ¤© (æœ€é«˜)</label>
    
    <input type="radio" id="cond2" name="condition" value="ğŸ˜€" required>
    <label for="cond2">ğŸ˜€ (å¥½èª¿)</label>
    
    <input type="radio" id="cond3" name="condition" value="ğŸ™‚" required>
    <label for="cond3">ğŸ™‚ (æ™®é€š)</label>
    
    <input type="radio" id="cond4" name="condition" value="ğŸ˜" required>
    <label for="cond4">ğŸ˜ (ã¼ã¡ã¼ã¡)</label>
    
    <input type="radio" id="cond5" name="condition" value="ğŸ˜µâ€ğŸ’«" required>
    <label for="cond5">ğŸ˜µâ€ğŸ’« (ã‚„ã‚„ç–²åŠ´)</label>
    
    <input type="radio" id="cond6" name="condition" value="ğŸ˜«" required>
    <label for="cond6">ğŸ˜« (ä¸èª¿)</label>
    
    <input type="radio" id="cond7" name="condition" value="ğŸ˜´" required>
    <label for="cond7">ğŸ˜´ (å¯ä¸è¶³)</label>
    
    <input type="radio" id="cond8" name="condition" value="ğŸ’ª" required>
    <label for="cond8">ğŸ’ª (ã‚„ã‚‹æ°—æº€ã€…)</label>
    
    <input type="radio" id="cond9" name="condition" value="ğŸ¤”" required>
    <label for="cond9">ğŸ¤” (è€ƒãˆä¸­)</label>
    
    <input type="radio" id="cond10" name="condition" value="ğŸ¥³" required>
    <label for="cond10">ğŸ¥³ (é”æˆæ„Ÿ)</label>

</div>
<br>
    
    <textarea id="todayTask" placeholder="ä»Šæ—¥ã‚„ã£ãŸã“ã¨ (å¿…é ˆ)" rows="3" required></textarea>
    <textarea id="nextTask" placeholder="ç¿Œå–¶æ¥­æ—¥ã‚„ã‚‹ã“ã¨ (å¿…é ˆ)" rows="3" required></textarea>
    <textarea id="impression" placeholder="æ‰€æ„Ÿãƒ»å­¦ã³ (ä»»æ„)" rows="3"></textarea>
    
    <button type="button" onclick="postReport()">é€ä¿¡</button> </form>

    <hr>
    
    <div class="report-list-header">
        <h2>éå»ã®æ—¥å ±ä¸€è¦§</h2>
        <div id="showMoreContainer"></div> 
    </div>

    <div id="reportList">
    </div>

    <script>
        // ----------------------------------------------------
        // 1. è¨­å®š
        // ----------------------------------------------------
        // ã“ã“ã«GASã®ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªURLã‚’è²¼ã‚Šä»˜ã‘ã¾ã™
        const GAS_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbwV0pz9MJwhiHAMywG6nMRBWefmcpa1YpSDYwfAYkrROpiFTez9TuINq0tfM0T3PvdGGg/exec'; 
        
        // ã€è¿½åŠ ã€‘è¡¨ç¤ºåˆ¶å¾¡ç”¨ã®å¤‰æ•°
        const INITIAL_LIMIT = 10; // æœ€åˆã«è¡¨ç¤ºã™ã‚‹ä»¶æ•°
        const DISPLAY_STEP = 10; // ã€Œã•ã‚‰ã«è¡¨ç¤ºã€ã§å¢—ã‚„ã™ä»¶æ•°
        let currentLimit = INITIAL_LIMIT; // ç¾åœ¨ã®è¡¨ç¤ºä»¶æ•°
        let allReports = []; // å…¨ã¦ã®æ—¥å ±ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒã™ã‚‹é…åˆ—

        // ----------------------------------------------------
        // 2. æ©Ÿèƒ½ â‘¡: æ—¥å ±ä¸€è¦§è¡¨ç¤ºæ©Ÿèƒ½ (GET)
        // ----------------------------------------------------
        async function fetchReports() {
            try {
                // GASå´ã§CORSãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ä»˜ã‘ã¦ã„ã‚‹ã®ã§ã€ä¸€è¦§ã‚’å–å¾—ã§ãã¾ã™
                // åˆå›ã¯å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                const response = await fetch(GAS_WEB_APP_URL); 
                const data = await response.json();
                
                // ã€å¤‰æ›´ã€‘å–å¾—ã—ãŸå…¨ãƒ‡ãƒ¼ã‚¿ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«ä¿å­˜
                allReports = data.data; 

                // æç”»é–¢æ•°ã‚’å‘¼ã³å‡ºã™
                renderReports();

            } catch (error) {
                console.error("æ—¥å ±ã®èª­ã¿è¾¼ã¿ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:", error);
                document.getElementById('reportList').innerHTML = '<p>æ—¥å ±ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</p>';
            }
        }
        
        // ã€è¿½åŠ ã€‘æ—¥å ±ã‚’å®Ÿéš›ã«ç”»é¢ã«æç”»ã™ã‚‹é–¢æ•°
        function renderReports() {
            const reportListElement = document.getElementById('reportList');
            reportListElement.innerHTML = ''; // ä¸€æ—¦ã‚¯ãƒªã‚¢
            
            // è¡¨ç¤ºã™ã‚‹æ—¥å ±ã‚’ currentLimit ã¾ã§ã«çµã‚‹ï¼ˆæ–°ã—ã„ã‚‚ã®ã‹ã‚‰ currentLimit ä»¶ï¼‰
            const reportsToDisplay = allReports.slice(0, currentLimit); 

            reportsToDisplay.forEach(report => {
                const item = document.createElement('div');
                item.className = 'report-item';
                item.innerHTML = `
                    <div class="report-header">
                        <span>**${report.name}** / ${report.date} / ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³: ${report.condition}</span>
                        <span>
                            <button class="like-button" onclick="likeReport('${report.id}', this)">
                                ã„ã„ã­ğŸ‘ (<span id="likeCount-${report.id}">${report.likes}</span>)
                            </button>
                        </span>
                    </div>
                    <div class="report-content">
                        <strong>ä»Šæ—¥ã‚„ã£ãŸã“ã¨:</strong> ${report.todayTask.replace(/\n/g, '<br>')}
                        <strong>ç¿Œå–¶æ¥­æ—¥ã‚„ã‚‹ã“ã¨:</strong> ${report.nextTask.replace(/\n/g, '<br>')}
                        <strong>æ‰€æ„Ÿãƒ»å­¦ã³:</strong> ${report.impression.replace(/\n/g, '<br>')}
                    </div>
                `;
                reportListElement.appendChild(item);
            });
            
            // ã€è¿½åŠ ã€‘ã€Œã•ã‚‰ã«éå»ã®æ—¥å ±ã‚’è¡¨ç¤ºã™ã‚‹ã€ãƒœã‚¿ãƒ³ã®è¡¨ç¤ºåˆ¶å¾¡
            updateShowMoreButton();
        }

        // ã€è¿½åŠ ã€‘ãƒœã‚¿ãƒ³ã®è¡¨ç¤ºãƒ»éè¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹é–¢æ•°
        function updateShowMoreButton() {
            const showMoreContainer = document.getElementById('showMoreContainer');
            showMoreContainer.innerHTML = ''; // ãƒœã‚¿ãƒ³ã‚³ãƒ³ãƒ†ãƒŠã‚’ã‚¯ãƒªã‚¢

            // å…¨ä½“ã®ä»¶æ•°ãŒç¾åœ¨ã®è¡¨ç¤ºä»¶æ•°ã‚ˆã‚Šå¤šã„å ´åˆã«ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
            if (allReports.length > currentLimit) {
                const button = document.createElement('button');
                button.className = 'show-more-button';
                // ã‚ã¨ä½•ä»¶æ®‹ã£ã¦ã„ã‚‹ã‹ã‚’è¡¨ç¤º
                const remaining = allReports.length - currentLimit;
                button.textContent = `ã•ã‚‰ã«éå»ã®æ—¥å ±ã‚’è¡¨ç¤ºã™ã‚‹ (${remaining}ä»¶)`; 
                button.onclick = showMoreReports; // ã‚¯ãƒªãƒƒã‚¯æ™‚ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¨­å®š
                showMoreContainer.appendChild(button);
            }
        }

        // ã€è¿½åŠ ã€‘ã€Œã•ã‚‰ã«è¡¨ç¤ºã€ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸæ™‚ã®å‡¦ç†
        function showMoreReports() {
            // è¡¨ç¤ºä»¶æ•°ã‚’å¢—ã‚„ã™
            currentLimit += DISPLAY_STEP; 
            
            // å…¨ä½“ã®ä»¶æ•°ã‚’è¶…ãˆãªã„ã‚ˆã†ã«èª¿æ•´
            if (currentLimit > allReports.length) {
                currentLimit = allReports.length;
            }
            
            // æ—¥å ±ã‚’å†æç”»
            renderReports(); 
        }

        // ----------------------------------------------------
        // 3. æ©Ÿèƒ½ â‘ : æ—¥å ±æŠ•ç¨¿æ©Ÿèƒ½ (POST) 
        // ----------------------------------------------------
        async function postReport() {
            const name = document.getElementById('name').value.trim();
            const conditionElement = document.querySelector('input[name="condition"]:checked');
            const condition = conditionElement ? conditionElement.value : '';
            const todayTask = document.getElementById('todayTask').value.trim();
            const nextTask = document.getElementById('nextTask').value.trim();
            const impression = document.getElementById('impression').value.trim();

            if (!name || !condition || !todayTask || !nextTask) {
                alert('åå‰ã€ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ã€ä»Šæ—¥ã‚„ã£ãŸã“ã¨ã€ç¿Œå–¶æ¥­æ—¥ã‚„ã‚‹ã“ã¨ ã¯å¿…é ˆé …ç›®ã§ã™ã€‚');
                return;
            }

            const postData = {
                name: name, condition: condition, todayTask: todayTask, nextTask: nextTask, impression: impression
            };

            try {
                // CORSã‚¨ãƒ©ãƒ¼å›é¿ã®ãŸã‚ no-cors ã‚’ä½¿ç”¨
                await fetch(GAS_WEB_APP_URL, {
                    method: 'POST',
                    mode: 'no-cors', 
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(postData) 
                });

                alert('æ—¥å ±ãŒæ­£å¸¸ã«æŠ•ç¨¿ã•ã‚Œã¾ã—ãŸï¼');
                document.querySelector('.report-form').reset(); 
                
                // ã€å¤‰æ›´ã€‘æŠ•ç¨¿å¾Œã€è¡¨ç¤ºä»¶æ•°ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦ä¸€è¦§ã‚’æ›´æ–°
                currentLimit = INITIAL_LIMIT; 
                fetchReports(); 

            } catch (error) {
                console.error('æŠ•ç¨¿ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
                alert('é€šä¿¡ã‚¨ãƒ©ãƒ¼ã«ã‚ˆã‚ŠæŠ•ç¨¿ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚');
            }
        }

        // ----------------------------------------------------
        // 4. æ©Ÿèƒ½ â‘¢: ã€Œã„ã„ã­ã€ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ (ä¿ç•™éƒ¨åˆ†)
        // ----------------------------------------------------
        async function likeReport(reportId, buttonElement) {
            alert(`ID: ${reportId} ã®æ—¥å ±ã«ã€Œã„ã„ã­ã€ã‚’æŠ¼ã—ã¾ã—ãŸï¼\n\nï¼ˆâ€»ã„ã„ã­æ•°ã®æ›´æ–°å‡¦ç†ã¯ã€æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã§å®Ÿè£…ã—ã¾ã™ï¼‰`);
        }
        
        // 5. ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®å‡¦ç†
        window.onload = fetchReports;

    </script>
</body>
</html>
