<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>SysLog (ã‚·ã‚¹ãƒ†ãƒ èª²æ—¥å ±)</title>
    <style>
        /* ç°¡å˜ãªãƒ‡ã‚¶ã‚¤ãƒ³ï¼ˆCSSï¼‰ */
        body { font-family: sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        h1 { border-bottom: 2px solid #ccc; padding-bottom: 5px; }
        .report-form input[type="text"], .report-form textarea, .report-form select {
            width: 100%; padding: 8px; margin-bottom: 10px; box-sizing: border-box;
        }
        .report-form button { padding: 10px 15px; background-color: #4CAF50; color: white; border: none; cursor: pointer; }
        .report-item { border: 1px solid #eee; padding: 15px; margin-bottom: 10px; border-radius: 5px; }
        .report-header { display: flex; justify-content: space-between; font-size: 0.9em; color: #666; margin-bottom: 5px;}
        .report-content strong { display: block; margin-top: 5px; color: #333; }
        .like-button { background-color: #f0f0f0; border: none; padding: 5px 10px; cursor: pointer; border-radius: 3px; }
    </style>
</head>
<body>

    <h1>SysLog (ã‚·ã‚¹ãƒ†ãƒ èª²æ—¥å ±)</h1>

    <section class="report-form">
        <h2>æ—¥å ±ã‚’æŠ•ç¨¿ã™ã‚‹</h2>
        <input type="text" id="name" placeholder="åå‰ (å¿…é ˆ)" required>
        
        <label for="condition">ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ (å¿…é ˆ):</label>
        <select id="condition" required>
            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
            <option value="ğŸ˜€">ğŸ˜€ (å¥½èª¿)</option>
            <option value="ğŸ™‚">ğŸ™‚ (æ™®é€š)</option>
            <option value="ğŸ˜«">ğŸ˜« (ä¸èª¿)</option>
        </select>
        
        <textarea id="todayTask" placeholder="ä»Šæ—¥ã‚„ã£ãŸã“ã¨ (å¿…é ˆ)" rows="3" required></textarea>
        <textarea id="nextTask" placeholder="ç¿Œå–¶æ¥­æ—¥ã‚„ã‚‹ã“ã¨ (å¿…é ˆ)" rows="3" required></textarea>
        <textarea id="impression" placeholder="æ‰€æ„Ÿãƒ»å­¦ã³ (ä»»æ„)" rows="3"></textarea>
        
        <button onclick="postReport()">é€ä¿¡</button>
    </section>

    <hr>
    
    <h2>éå»ã®æ—¥å ±ä¸€è¦§</h2>
    <div id="reportList">
        </div>

    <script>
        // â˜…â˜…â˜…ã“ã“ã«ã€å…ˆã»ã©Apps Scriptã§å–å¾—ã—ãŸã€Œã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã®URLã€ã‚’å…¥ã‚Œã¦ãã ã•ã„â˜…â˜…â˜…
        const GAS_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbwV0pz9MJwhiHAMywG6nMRBWefmcpa1YpSDYwfAYkrROpiFTez9TuINq0tfM0T3PvdGGg/exec'; 

        // ----------------------------------------------------
        // æ©Ÿèƒ½ â‘¡: æ—¥å ±ä¸€è¦§è¡¨ç¤ºæ©Ÿèƒ½
        // ----------------------------------------------------
        async function postReport() {
    // ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰å€¤ã‚’å–å¾—ã™ã‚‹éƒ¨åˆ†ã¯å¤‰æ›´ãªã—
    const name = document.getElementById('name').value.trim();
    const condition = document.getElementById('condition').value;
    const todayTask = document.getElementById('todayTask').value.trim();
    const nextTask = document.getElementById('nextTask').value.trim();
    const impression = document.getElementById('impression').value.trim();

    // å¿…é ˆãƒã‚§ãƒƒã‚¯ã¯å¤‰æ›´ãªã—
    if (!name || !condition || !todayTask || !nextTask) {
        alert('åå‰ã€ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ã€ä»Šæ—¥ã‚„ã£ãŸã“ã¨ã€ç¿Œå–¶æ¥­æ—¥ã‚„ã‚‹ã“ã¨ ã¯å¿…é ˆé …ç›®ã§ã™ã€‚');
        return;
    }

    // GASã«é€ã‚‹ãƒ‡ãƒ¼ã‚¿ï¼ˆJSONå½¢å¼ï¼‰
    const postData = {
        name: name,
        condition: condition,
        todayTask: todayTask,
        nextTask: nextTask,
        impression: impression
    };

    try {
        // GASã®URLã«ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ (POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆ)
        const response = await fetch(GAS_WEB_APP_URL, {
            method: 'POST',
            mode: 'no-cors', // â˜…CORSã‚¨ãƒ©ãƒ¼å›é¿ã®ãŸã‚ã€ã“ã®è¨­å®šã‚’è¿½åŠ 
            headers: {
                // no-corsãƒ¢ãƒ¼ãƒ‰ã§ã¯ä¸€éƒ¨ãƒ˜ãƒƒãƒ€ãƒ¼ãŒç„¡åŠ¹ã«ãªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ãŒã€ä»Šå›ã¯æ®‹ã—ã¦ãŠãã¾ã™
                'Content-Type': 'application/json' 
            },
            // JSONãƒ‡ãƒ¼ã‚¿ã‚’æ–‡å­—åˆ—ã«ã—ã¦é€ä¿¡
            body: JSON.stringify(postData) 
        });

        // â˜…é‡è¦: no-corsãƒ¢ãƒ¼ãƒ‰ã§ã¯æ­£å¸¸ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒå–ã‚Œãªã„ãŸã‚ã€
        // response.json() ã§ã®åˆ¤å®šã¯è¡Œã‚ãšã€fetchã«æˆåŠŸã—ãŸã‚‰å®Œäº†ã¨ã¿ãªã—ã¾ã™ã€‚

        alert('æ—¥å ±ãŒæ­£å¸¸ã«æŠ•ç¨¿ã•ã‚Œã¾ã—ãŸï¼');
        // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
        document.querySelector('.report-form').reset(); 
        // ä¸€è¦§ã‚’æ›´æ–°ã—ã¦ã€æ–°ã—ã„æŠ•ç¨¿ã‚’è¡¨ç¤º
        fetchReports();


    } catch (error) {
        // é€šä¿¡ãƒ–ãƒ­ãƒƒã‚¯ãªã©ã®è‡´å‘½çš„ãªã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã®ã¿ã“ã“ã«æ¥ã‚‹
        console.error('æŠ•ç¨¿ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
        alert('é€šä¿¡ã‚¨ãƒ©ãƒ¼ã«ã‚ˆã‚ŠæŠ•ç¨¿ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚');
    }
}

        // ãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚ŒãŸã‚‰ã€ã™ãã«æ—¥å ±ä¸€è¦§ã‚’è¡¨ç¤ºã™ã‚‹
        window.onload = fetchReports;

        // ----------------------------------------------------
        // æ©Ÿèƒ½ â‘ : æ—¥å ±æŠ•ç¨¿æ©Ÿèƒ½
        // ----------------------------------------------------
        async function postReport() {
    // ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰å€¤ã‚’å–å¾—ã™ã‚‹å‡¦ç†ï¼ˆä¸­ç•¥ï¼‰

    // å¿…é ˆãƒã‚§ãƒƒã‚¯ï¼ˆä¸­ç•¥ï¼‰

    // GASã«é€ã‚‹ãƒ‡ãƒ¼ã‚¿ï¼ˆpostDataï¼‰ä½œæˆï¼ˆä¸­ç•¥ï¼‰

    try {
        await fetch(GAS_WEB_APP_URL, {
            method: 'POST',
            mode: 'no-cors', // â˜…CORSã‚¨ãƒ©ãƒ¼å›é¿ã®ãŸã‚ã®é‡è¦è¨­å®š
            headers: {
                'Content-Type': 'application/json' 
            },
            body: JSON.stringify(postData) 
        });

        // æˆåŠŸã¨ã¿ãªã™
        alert('æ—¥å ±ãŒæ­£å¸¸ã«æŠ•ç¨¿ã•ã‚Œã¾ã—ãŸï¼'); 
        document.querySelector('.report-form').reset(); 
        
        // â˜…ã“ã®è¡Œã§ã€ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã€ŒfetchReportsã€ã‚’å‘¼ã‚“ã§ã„ã‚‹
        fetchReports(); 

    } catch (error) {
        console.error('æŠ•ç¨¿ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
        alert('é€šä¿¡ã‚¨ãƒ©ãƒ¼ã«ã‚ˆã‚ŠæŠ•ç¨¿ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚');
    }
}

            try {
                // GASã®URLã«ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ (POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆ)
                const response = await fetch(GAS_WEB_APP_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    // JSONãƒ‡ãƒ¼ã‚¿ã‚’æ–‡å­—åˆ—ã«ã—ã¦é€ä¿¡
                    body: JSON.stringify(postData) 
                });

                const result = await response.json();

                if (result.status === 'success') {
                    alert('æ—¥å ±ãŒæ­£å¸¸ã«æŠ•ç¨¿ã•ã‚Œã¾ã—ãŸï¼');
                    // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
                    document.querySelector('.report-form').reset(); 
                    // ä¸€è¦§ã‚’æ›´æ–°ã—ã¦ã€æ–°ã—ã„æŠ•ç¨¿ã‚’è¡¨ç¤º
                    fetchReports();
                } else {
                    alert('æŠ•ç¨¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
                }

            } catch (error) {
                console.error('æŠ•ç¨¿ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
                alert('é€šä¿¡ã‚¨ãƒ©ãƒ¼ã«ã‚ˆã‚ŠæŠ•ç¨¿ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚');
            }
        }
        
        // ----------------------------------------------------
        // æ©Ÿèƒ½ â‘¢: ã€Œã„ã„ã­ã€ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ©Ÿèƒ½
        // ----------------------------------------------------
        async function likeReport(reportId, buttonElement) {
            // â˜…å®Ÿè£…ã®ç°¡ç•¥åŒ–ã®ãŸã‚ã€ã„ã„ã­æ©Ÿèƒ½ã¯ä¸€æ—¦ä¿ç•™ã—ã¾ã™â˜…
            // GASå´ã®ã€Œã„ã„ã­å‡¦ç†ã€ã‚‚å¿…è¦ã«ãªã‚‹ãŸã‚ã€ã¾ãšã¯æŠ•ç¨¿ã¨ä¸€è¦§è¡¨ç¤ºã‚’å®Œæˆã•ã›ã¾ã—ã‚‡ã†ã€‚
            alert(`ID: ${reportId} ã®æ—¥å ±ã«ã€Œã„ã„ã­ã€ã‚’æŠ¼ã—ã¾ã—ãŸï¼\n\nï¼ˆâ€»ã„ã„ã­æ•°ã®æ›´æ–°å‡¦ç†ã¯ã€æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã§å®Ÿè£…ã—ã¾ã™ï¼‰`);
            
            // ã€æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ã®å®Ÿè£…ã‚¤ãƒ¡ãƒ¼ã‚¸ã€‘
            /*
            try {
                const response = await fetch(GAS_WEB_APP_URL + '?action=like&id=' + reportId, {
                    method: 'GET' // GETãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã„ã„ã­å‡¦ç†ã‚’å‘¼ã³å‡ºã™
                });
                const result = await response.json();
                if (result.status === 'success') {
                    // ç”»é¢ä¸Šã®ã„ã„ã­æ•°ã‚’+1ã™ã‚‹
                    const countElement = document.getElementById(`likeCount-${reportId}`);
                    countElement.textContent = parseInt(countElement.textContent) + 1;
                }
            } catch (error) {
                console.error('ã„ã„ã­å‡¦ç†ã«å¤±æ•—:', error);
            }
            */
        }

    </script>
</body>
</html>
